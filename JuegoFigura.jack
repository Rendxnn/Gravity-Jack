class JuegoFigura {
    field Figura figura;
    field int direccion;
    field Base base_inicial;
    field Plataforma plataforma;

    constructor JuegoFigura new() {
        let direccion = 0;
        let figura = Figura.new(2, 150);
        let base_inicial = Base.new(2, 167);
        let plataforma = Plataforma.new(base_inicial);

        do figura.saltar();
        return this;
    }

    method void dispose() {
        do figura.dispose();
        do Memory.deAlloc(this);
        return;
    }

    method void moverFigura() {
        var int i;
        var int j;
        if (direccion = 1) {
            let i = 0;
            let j = 0;
            while (i < 50) {
                do figura.saltar();
                if (j = 9) {
                    do plataforma.avanzar();
                    let j = 0;
                }
                do Sys.wait(2);
                let i = i + 1;
                let j = j + 1;
                }
        }
        return;
    }

    method void dejar_caer() {
        var int i;
        var int j;

        let i = 0;
        let j = 0;
        while (i < 5) {
            do figura.caer();
            if (j = 9) {
                do plataforma.avanzar();
                let j = 0;
            }
            do Sys.wait(4);
            let i = i + 1;
            let j = j + 1;
        }
        return;
    }



    method void run() {
        var int i;
        var char tecla;
        var boolean exit;
        var int sobre;

        //let bases = plataforma.get_bases();
        let exit = false;

        while (~exit){
            let sobre = plataforma.sobre_base(figura.get_y());
            let tecla = Keyboard.keyPressed();
            do Output.printInt(sobre);
            if (sobre) {
                if (tecla = 131) {
                    let direccion = 1;
                    do moverFigura();
                }
            }
            if (~sobre) {
                do figura.caer();
            }
            do plataforma.avanzar();
            do Sys.wait(60);
        }
        return;
    }
}